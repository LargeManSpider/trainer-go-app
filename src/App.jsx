import React, { useState, useEffect, useMemo } from 'react';
import { Dumbbell, Activity, ArrowLeft, Plus, Trash2, Save, CheckCircle2, Circle, TrendingUp, Timer, Footprints, Target, PersonStanding, Move, X, AlertCircle, History, Share, Copy, Check, Ghost, LineChart as LineChartIcon, MessageSquare, Play, Pause, PlusCircle, User, PlayCircle, Download, Loader2 } from 'lucide-react';
import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';

const ICON_MAP = { push: Dumbbell, pull: Target, legs: PersonStanding, functional: Move, cardio: Activity, dumbbell: Dumbbell, activity: Activity, default: Activity };
const REST_TIMER_DEFAULT = 60;
const createSet = (id, weight = 0, reps = 10, completed = false) => ({ id: id || Date.now(), weight, reps, completed });
const SmartInput = ({ value, onCommit, placeholder, type = "text", className, step }) => {
  const [localValue, setLocalValue] = useState(value || '');
  useEffect(() => setLocalValue(value || ''), [value]);
  const handleBlur = () => { if (localValue !== value) onCommit(localValue); };
  const handleKeyDown = (e) => { if (e.key === 'Enter') e.target.blur(); };
  return <input type={type} step={step} className={className} placeholder={placeholder} value={localValue} onChange={(e) => setLocalValue(e.target.value)} onBlur={handleBlur} onKeyDown={handleKeyDown} />;
};
const RestTimer = ({ isOpen, onClose }) => {
  const [timeLeft, setTimeLeft] = useState(REST_TIMER_DEFAULT);
  const [isPaused, setIsPaused] = useState(false);
  useEffect(() => { if (!isOpen) { setTimeLeft(REST_TIMER_DEFAULT); setIsPaused(false); return; } const interval = setInterval(() => { if (!isPaused && timeLeft > 0) setTimeLeft((prev) => prev - 1); else if (timeLeft === 0) { if (navigator.vibrate) navigator.vibrate([200, 100, 200]); clearInterval(interval); } }, 1000); return () => clearInterval(interval); }, [isOpen, isPaused, timeLeft]);
  if (!isOpen) return null;
  return (<div className="fixed bottom-4 left-4 right-4 z-40 animate-in slide-in-from-bottom-4 duration-300"><div className="bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl p-4 flex items-center gap-4 relative overflow-hidden"><div className="absolute bottom-0 left-0 h-1 bg-slate-800 w-full"><div className="h-full bg-blue-500 transition-all duration-1000" style={{ width: `${((REST_TIMER_DEFAULT - timeLeft) / REST_TIMER_DEFAULT) * 100}%` }} /></div><div className="bg-slate-800 p-3 rounded-full"><Timer className={timeLeft === 0 ? "text-emerald-400 animate-pulse" : "text-blue-400"} size={24} /></div><div className="flex-1"><p className="text-xs text-slate-400 uppercase font-bold tracking-wider">Rest Timer</p><p className={`text-2xl font-mono font-bold ${timeLeft === 0 ? "text-emerald-400" : "text-white"}`}>{timeLeft === 0 ? "READY" : `${Math.floor(timeLeft / 60)}:${(timeLeft % 60).toString().padStart(2, '0')}`}</p></div><div className="flex items-center gap-2"><button onClick={() => setTimeLeft(t => t + 30)} className="p-2 text-slate-400 hover:text-white bg-slate-800 rounded-full"><PlusCircle size={20} /></button><button onClick={() => setIsPaused(!isPaused)} className="p-2 text-slate-400 hover:text-white bg-slate-800 rounded-full">{isPaused ? <Play size={20} /> : <Pause size={20} />}</button><button onClick={onClose} className="p-2 text-slate-400 hover:text-red-400 bg-slate-800 rounded-full"><X size={20} /></button></div></div></div>);
};

export default function App() {
  const [clientSetup, setClientSetup] = useState(null); const [configLoading, setConfigLoading] = useState(true); const [configError, setConfigError] = useState(null);
  const [activeDayId, setActiveDayId] = useState(null); const [showHistory, setShowHistory] = useState(false); const [workouts, setWorkouts] = useState({}); const [history, setHistory] = useState([]); const [isDataLoaded, setIsDataLoaded] = useState(false);
  const [timerOpen, setTimerOpen] = useState(false); const [modalOpen, setModalOpen] = useState(false); const [modalType, setModalType] = useState(null); const [modalData, setModalData] = useState({}); const [inputText, setInputText] = useState(""); const [sessionRpe, setSessionRpe] = useState(5); const [statsModalOpen, setStatsModalOpen] = useState(false); const [statsExercise, setStatsExercise] = useState(null);

  useEffect(() => { const fetchConfig = async () => { const params = new URLSearchParams(window.location.search); const clientId = params.get('client'); if (!clientId) { setConfigError("MISSING_ID"); setConfigLoading(false); return; } try { const response = await fetch(`/${clientId}.json`); if (!response.ok) throw new Error("Client file not found"); setClientSetup(await response.json()); } catch (err) { setConfigError("LOAD_FAILED"); } finally { setConfigLoading(false); } }; fetchConfig(); }, []);
  
  useEffect(() => { 
    if (!clientSetup) return; 
    const storageKeyData = `trainerGo_data_${clientSetup.clientName}`; 
    const storageKeyHistory = `trainerGo_history_${clientSetup.clientName}`; 
    const savedData = localStorage.getItem(storageKeyData); 
    const savedHistory = localStorage.getItem(storageKeyHistory); 

    const freshMap = {};
    clientSetup.program.forEach(day => { freshMap[day.id] = day.exercises; });

    if (savedData) {
      try {
        const parsed = JSON.parse(savedData);
        Object.keys(freshMap).forEach(id => {
          if (parsed[id]) freshMap[id] = parsed[id]; 
        });
      } catch (e) {}
    }

    setWorkouts(freshMap);
    if (savedHistory) { try { setHistory(JSON.parse(savedHistory)); } catch (e) {} } 
    setIsDataLoaded(true); 
  }, [clientSetup]);

  useEffect(() => { if (isDataLoaded && clientSetup) { localStorage.setItem(`trainerGo_data_${clientSetup.clientName}`, JSON.stringify(workouts)); localStorage.setItem(`trainerGo_history_${clientSetup.clientName}`, JSON.stringify(history)); } }, [workouts, history, isDataLoaded, clientSetup]);
  const previousStatsMap = useMemo(() => { if (!activeDayId || !history.length || !workouts[activeDayId]) return {}; const map = {}; const sortedHistory = [...history].sort((a, b) => new Date(b.date) - new Date(a.date)); workouts[activeDayId].forEach(currentEx => { const matchSession = sortedHistory.find(s => s.exercises.some(e => e.name.toLowerCase().trim() === currentEx.name.toLowerCase().trim())); if (matchSession) map[currentEx.id] = matchSession.exercises.find(e => e.name.toLowerCase().trim() === currentEx.name.toLowerCase().trim()); }); return map; }, [history, workouts, activeDayId]);
  const getExerciseChartData = (exerciseName) => { const data = []; history.forEach(session => { const ex = session.exercises.find(e => e.name.toLowerCase().trim() === exerciseName.toLowerCase().trim()); if (ex && ex.sets) { let max1RM = 0; ex.sets.forEach(s => { const est1RM = Number(s.weight) * (1 + Number(s.reps) / 30); if (est1RM > max1RM) max1RM = est1RM; }); data.push({ timestamp: new Date(session.date).getTime(), date: new Date(session.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }), volume: ex.volume || 0, oneRM: Math.round(max1RM) }); } }); return data.sort((a, b) => a.timestamp - b.timestamp); };
  const generateReport = () => { if (history.length === 0) { alert("No history yet!"); return; } const recent = [...history].sort((a,b) => new Date(b.date) - new Date(a.date)).slice(0, 3); let report = `Hey ${clientSetup.trainerName}, progress for ${clientSetup.programName}:\n\n`; recent.forEach(session => { report += `ðŸ“… ${new Date(session.date).toLocaleDateString()} - ${clientSetup.program.find(p => p.id === session.dayId)?.title} (RPE: ${session.rpe || '-'}/10)\n`; session.exercises.forEach(ex => { if(ex.type === 'cardio') report += `   â€¢ ${ex.name}: ${ex.distance}${ex.unit} in ${ex.time}m\n`; else { const bestSet = ex.sets.reduce((p, c) => Number(p.weight) > Number(c.weight) ? p : c); report += `   â€¢ ${ex.name}: Best ${bestSet.weight}lbs x ${bestSet.reps}\n`; } }); report += '\n'; }); navigator.clipboard.writeText(report).then(() => alert("Report copied!")); };
  const openAddModal = (dayId) => { setModalType('add'); setModalData({ dayId }); setInputText(""); setModalOpen(true); }; const openResetModal = (dayId) => { setModalType('reset'); setModalData({ dayId }); setSessionRpe(5); setModalOpen(true); }; const closeModal = () => { setModalOpen(false); setModalType(null); setModalData({}); };
  const confirmAction = () => { const { dayId, exerciseId } = modalData; if (modalType === 'add') { if (!inputText.trim()) return; const newEx = { id: Date.now(), name: inputText, isProgrammed: false, sets: [createSet(Date.now(), 0, 10), createSet(Date.now()+1, 0, 10), createSet(Date.now()+2, 0, 10)] }; setWorkouts(p => ({ ...p, [dayId]: [...p[dayId], newEx] })); } else if (modalType === 'delete') { setWorkouts(p => ({ ...p, [dayId]: p[dayId].filter(i => i.id !== exerciseId) })); } else if (modalType === 'reset') { const currentWorkout = workouts[dayId]; const completedExercises = currentWorkout.map(ex => { if (ex.type === 'cardio') return ex.completed ? { ...ex } : null; const completedSets = ex.sets.filter(s => s.completed).map(s => ({ ...s, weight: Number(s.weight), reps: Number(s.reps) })); if (completedSets.length > 0) return { ...ex, sets: completedSets, volume: completedSets.reduce((a, s) => a + (s.weight * s.reps), 0) }; return null; }).filter(Boolean); if (completedExercises.length > 0) setHistory(p => [{ id: Date.now(), date: new Date().toISOString(), dayId, rpe: sessionRpe, exercises: completedExercises }, ...p]); setWorkouts(p => ({ ...p, [dayId]: p[dayId].map(ex => ({ ...ex, completed: false, sets: ex.sets.map(s => ({ ...s, completed: false })) })) })); setActiveDayId(null); setTimerOpen(false); } closeModal(); };
  const updateSet = (dayId, exId, setId, field, val) => setWorkouts(p => ({ ...p, [dayId]: p[dayId].map(ex => ex.id !== exId ? ex : { ...ex, sets: ex.sets.map(s => s.id === setId ? { ...s, [field]: val } : s) }) })); 
  const toggleSetComplete = (dayId, exId, setId) => { const set = workouts[dayId].find(e => e.id === exId).sets.find(s => s.id === setId); if (!set.completed) setTimerOpen(true); setWorkouts(p => ({ ...p, [dayId]: p[dayId].map(ex => ex.id !== exId ? ex : { ...ex, sets: ex.sets.map(s => s.id === setId ? { ...s, completed: !s.completed } : s) }) })); }; 
  const addSet = (dayId, exId) => setWorkouts(p => ({ ...p, [dayId]: p[dayId].map(ex => ex.id !== exId ? ex : { ...ex, sets: [...ex.sets, createSet(Date.now(), ex.sets[ex.sets.length-1]?.weight, ex.sets[ex.sets.length-1]?.reps)] }) })); 
  const removeSet = (dayId, exId, setId) => { setWorkouts(p => ({ ...p, [dayId]: p[dayId].map(ex => ex.id !== exId ? ex : { ...ex, sets: ex.sets.filter(s => s.id !== setId) }) })); };
  const updateExercise = (dayId, id, field, val) => setWorkouts(p => ({ ...p, [dayId]: p[dayId].map(i => i.id === id ? { ...i, [field]: val } : i) })); const toggleCardioComplete = (dayId, id) => setWorkouts(p => ({ ...p, [dayId]: p[dayId].map(i => i.id === id ? { ...i, completed: !i.completed } : i) }));

  if (configLoading) return <div className="min-h-screen bg-slate-950 flex flex-col items-center justify-center text-slate-400 gap-4"><Loader2 className="animate-spin text-blue-500" size={48} /><p>Loading Program...</p></div>;
  if (configError || !clientSetup) return <div className="min-h-screen bg-slate-950 flex flex-col items-center justify-center text-slate-400 p-6 text-center"><AlertCircle className="text-red-400 mb-4" size={48} /><h2 className="text-xl font-bold text-white mb-2">Setup Required</h2><p className="mb-6 max-w-xs mx-auto">{configError === "MISSING_ID" ? "Please use the personal link sent by your coach." : "Could not load the client profile."}</p><p className="text-xs text-slate-600">Example: /?client=caroline</p></div>;

  return (
    <div className="min-h-screen bg-slate-950 text-slate-100 font-sans selection:bg-blue-500 selection:text-white pb-32 relative">
      <RestTimer isOpen={timerOpen} onClose={() => setTimerOpen(false)} />
      {statsModalOpen && statsExercise && <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-950/90 backdrop-blur-sm animate-in fade-in duration-200"><div className="bg-slate-900 border border-slate-700 w-full max-w-md rounded-2xl shadow-2xl p-6 flex flex-col h-3/4 max-h-[500px]"><div className="flex justify-between items-center mb-4"><h3 className="font-bold text-white">{statsExercise}</h3><button onClick={() => setStatsModalOpen(false)}><X size={20} className="text-slate-500" /></button></div><div className="flex-1"><ResponsiveContainer width="100%" height="100%"><AreaChart data={getExerciseChartData(statsExercise)}><defs><linearGradient id="colorVal" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#3b82f6" stopOpacity={0.3}/><stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/></linearGradient></defs><CartesianGrid strokeDasharray="3 3" stroke="#1e293b" vertical={false} /><XAxis dataKey="date" stroke="#64748b" fontSize={10} tickLine={false} axisLine={false} /><YAxis stroke="#64748b" fontSize={10} tickLine={false} axisLine={false} domain={['auto', 'auto']} /><Tooltip contentStyle={{backgroundColor: '#0f172a', borderColor: '#334155'}} /><Area type="monotone" dataKey="oneRM" stroke="#3b82f6" strokeWidth={3} fillOpacity={1} fill="url(#colorVal)" /></AreaChart></ResponsiveContainer></div></div></div>}
      {modalOpen && <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-950/80 backdrop-blur-sm animate-in fade-in duration-200"><div className="bg-slate-900 border border-slate-700 w-full max-w-sm rounded-2xl shadow-2xl p-6"><h3 className="text-xl font-bold text-white mb-4">{modalType === 'add' ? 'Add Extra Exercise' : modalType === 'reset' ? 'Finish Workout?' : 'Remove?'}</h3>{modalType === 'add' && <input autoFocus placeholder="Exercise Name" className="w-full bg-slate-950 border border-slate-700 rounded-xl p-3 text-white mb-4" value={inputText} onChange={(e) => setInputText(e.target.value)} />}{modalType === 'reset' && <div className="mb-6"><p className="text-slate-400 mb-4 text-sm">How hard was this session?</p><div className="relative pt-6 pb-2"><div className="flex justify-between text-[10px] text-slate-500 uppercase font-bold tracking-wider absolute top-0 w-full"><span>Easy</span><span>Moderate</span><span className="text-red-400">Max Effort</span></div><input type="range" min="1" max="10" value={sessionRpe} onChange={(e) => setSessionRpe(e.target.value)} className="w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-blue-500" /><div className="text-center mt-2 font-mono text-2xl font-bold text-white"><span className="text-blue-500">{sessionRpe}</span><span className="text-slate-600 text-lg">/10</span></div></div></div>}<div className="flex gap-3"><button onClick={closeModal} className="flex-1 py-3 rounded-xl font-medium text-slate-400 hover:bg-slate-800">Cancel</button><button onClick={confirmAction} className="flex-1 py-3 rounded-xl font-bold text-white bg-blue-500 hover:bg-blue-600 shadow-lg">Confirm</button></div></div></div>}
      <header className="sticky top-0 z-10 bg-slate-950/80 backdrop-blur-md border-b border-slate-800 p-4 shadow-lg"><div className="max-w-3xl mx-auto flex items-center justify-between">{activeDayId || showHistory ? <button onClick={() => { setActiveDayId(null); setShowHistory(false); }} className="flex items-center gap-2 text-slate-400 hover:text-white transition-colors"><ArrowLeft size={20} /> <span className="font-medium">Program</span></button> : <div className="flex items-center gap-2"><User className="text-blue-500" size={24} /><div><h1 className="text-sm font-bold text-slate-400 uppercase tracking-wide">CUSTOM TRAINING PROGRAM</h1></div></div>}{!activeDayId && !showHistory && <button onClick={() => setShowHistory(true)} className="p-2 text-slate-400 hover:text-white bg-slate-900 rounded-full border border-slate-800"><History size={20} /></button>}</div></header>
      <main className="max-w-3xl mx-auto p-4 md:p-6">
        {!activeDayId && !showHistory && <div className="animate-in fade-in slide-in-from-bottom-4 duration-500"><div className="mb-8 p-6 rounded-3xl bg-gradient-to-br from-slate-900 to-slate-900 border border-slate-800 shadow-xl relative overflow-hidden"><div className="absolute top-0 right-0 p-32 bg-blue-500/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div><h2 className="text-3xl font-bold text-white mb-2">Hi, {clientSetup.clientName} ðŸ‘‹</h2><p className="text-slate-400 mb-1">{clientSetup.programName}</p><div className="text-xs text-slate-500 uppercase tracking-wider font-bold mt-4">Coach: {clientSetup.trainerName}</div></div><div className="grid grid-cols-1 gap-4">{clientSetup.program.map((day) => { const dayExercises = workouts[day.id]; if (!dayExercises) return null; const totalCount = dayExercises.reduce((acc, ex) => ex.type === 'cardio' ? acc + 1 : acc + ex.sets.length, 0); const completedCount = dayExercises.reduce((acc, ex) => ex.type === 'cardio' ? acc + (ex.completed ? 1 : 0) : acc + ex.sets.filter(s => s.completed).length, 0); const percent = totalCount === 0 ? 0 : Math.round((completedCount / totalCount) * 100); const DayIcon = ICON_MAP[day.icon] || ICON_MAP.default; return (<button key={day.id} onClick={() => setActiveDayId(day.id)} className="group relative overflow-hidden rounded-3xl p-6 text-left transition-all hover:scale-[1.01] active:scale-[0.99] border border-slate-800 bg-slate-900/50"><div className={`absolute inset-0 bg-gradient-to-r ${day.gradient} opacity-0 group-hover:opacity-10 transition-opacity`} /><div className="flex items-start justify-between relative z-10"><div className="flex items-center gap-4"><div className={`p-3 rounded-2xl ${day.color} text-white shadow-lg shadow-black/20`}><DayIcon size={24} /></div><div><h3 className="text-lg font-bold text-white">{day.title}</h3><p className="text-sm text-slate-400">{day.sub}</p></div></div>{percent > 0 && <div className="text-xs font-bold text-emerald-400 bg-emerald-950/30 px-2 py-1 rounded border border-emerald-900/50">{percent}%</div>}</div></button>); })}</div></div>}
        {showHistory && <div className="animate-in slide-in-from-right-8 fade-in duration-300"><div className="bg-slate-900/50 border border-slate-800 rounded-2xl p-6 mb-6"><h3 className="text-lg font-bold text-white mb-2 flex items-center gap-2"><Share size={20} className="text-blue-400" /> Send Progress to Coach</h3><p className="text-sm text-slate-400 mb-4">Click below to copy a summary of your recent workouts.</p><button onClick={generateReport} className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-colors"><Copy size={18} /> Copy Report</button></div><div className="space-y-4">{history.length === 0 && <p className="text-center text-slate-500 py-8">No completed workouts yet.</p>}{[...history].sort((a,b) => new Date(b.date) - new Date(a.date)).map(entry => (<div key={entry.id} className="bg-slate-900 border border-slate-800 rounded-xl p-4"><div className="flex justify-between items-center mb-2"><span className="text-white font-bold">{clientSetup.program.find(p => p.id === entry.dayId)?.title}</span><span className="text-xs text-slate-500">{new Date(entry.date).toLocaleDateString()}</span></div><div className="flex justify-between text-xs text-slate-400"><span>{entry.exercises.length} Exercises</span>{entry.rpe && <span className="text-blue-400 font-bold">RPE: {entry.rpe}/10</span>}</div></div>))}</div></div>}
        {activeDayId && workouts[activeDayId] && <div className="animate-in slide-in-from-right-8 fade-in duration-300 pb-10"><div className="mb-6"><span className="text-xs font-bold text-blue-500 uppercase tracking-wider mb-1 block">Current Session</span><h2 className="text-3xl font-bold text-white">{clientSetup.program.find(p => p.id === activeDayId).title}</h2></div><div className="space-y-6">{workouts[activeDayId].map(exercise => { const prevStats = previousStatsMap[exercise.id]; return (<div key={exercise.id} className="bg-slate-900/80 border border-slate-800 rounded-2xl overflow-hidden shadow-lg"><div className="p-4 bg-slate-950/50 border-b border-slate-800/50 flex justify-between items-start"><div><h3 className="font-bold text-white text-lg flex items-center gap-2 flex-wrap">{exercise.name} {exercise.isProgrammed && <CheckCircle2 size={14} className="text-blue-500" title="Coach Programmed" />} {exercise.video && <a href={exercise.video} target="_blank" rel="noreferrer" className="ml-2 text-red-400 hover:text-red-300 bg-red-900/20 px-2 py-1 rounded text-[10px] flex items-center gap-1 uppercase font-bold tracking-wider"><PlayCircle size={12} /> Watch</a>}</h3>{exercise.note && <div className="text-xs text-blue-400 mt-2 flex items-start gap-1.5"><MessageSquare size={12} className="shrink-0 mt-0.5" /><div className="flex-1">{exercise.note.includes('â€¢') ? exercise.note.split('â€¢').filter(line => line.trim()).map((line, i) => <div key={i} className="mb-1">â€¢ {line.trim()}</div>) : <p>{exercise.note}</p>}</div></div>}{prevStats && <div className="mt-2 text-xs text-slate-500 flex items-center gap-1.5"><Ghost size={12} /> Last: {exercise.type === 'cardio' ? `${prevStats.distance}${prevStats.unit}` : `${Math.max(...prevStats.sets.map(s=>Number(s.weight)))} lbs`}</div>}</div><div className="flex gap-2">{exercise.type !== 'cardio' && <button onClick={() => {setStatsExercise(exercise.name); setStatsModalOpen(true);}} className="p-2 text-slate-600 hover:text-blue-500 bg-slate-900 rounded-lg"><LineChartIcon size={16} /></button>}{!exercise.isProgrammed && <button onClick={() => {setModalData({dayId: activeDayId, exerciseId: exercise.id}); setModalType('delete'); setModalOpen(true);}} className="p-2 text-slate-600 hover:text-red-500 bg-slate-900 rounded-lg"><Trash2 size={16} /></button>}</div></div><div className="p-3">{exercise.type === 'cardio' ? (<div className="flex items-center gap-4 p-2"><button onClick={() => toggleCardioComplete(activeDayId, exercise.id)} className={exercise.completed ? "text-emerald-500" : "text-slate-700"}>{exercise.completed ? <CheckCircle2 size={32} /> : <Circle size={32} />}</button><div className="flex-1 grid grid-cols-2 gap-2"><div className="bg-slate-950 p-2 rounded border border-slate-800 flex items-center gap-2"><Footprints size={14} className="text-slate-500" /><SmartInput type="number" value={exercise.distance} onCommit={(v) => updateExercise(activeDayId, exercise.id, 'distance', v)} className="bg-transparent w-full text-right outline-none" /><span className="text-xs text-slate-500">{exercise.unit}</span></div><div className="bg-slate-950 p-2 rounded border border-slate-800 flex items-center gap-2"><Timer size={14} className="text-slate-500" /><SmartInput type="number" value={exercise.time} onCommit={(v) => updateExercise(activeDayId, exercise.id, 'time', v)} className="bg-transparent w-full text-right outline-none" /><span className="text-xs text-slate-500">min</span></div></div></div>) : (<div className="space-y-2"><div className="grid grid-cols-12 text-[10px] uppercase text-slate-500 font-bold tracking-wider mb-1 px-2"><div className="col-span-1 text-center">Set</div><div className="col-span-3 text-center">Lbs</div><div className="col-span-3 text-center">Reps</div><div className="col-span-3 text-center">Done</div><div className="col-span-2 text-center">Del</div></div>{exercise.sets.map((set, idx) => (<div key={set.id} className={`grid grid-cols-12 items-center gap-2 p-1.5 rounded-lg ${set.completed ? 'bg-emerald-900/10' : 'bg-slate-950/30'}`}><div className="col-span-1 text-center text-xs text-slate-500 font-mono">{idx + 1}</div><div className="col-span-3"><SmartInput type="number" placeholder={prevStats?.sets[idx]?.weight || '-'} value={set.weight || ''} onCommit={(v) => updateSet(activeDayId, exercise.id, set.id, 'weight', v)} className={`w-full text-center bg-slate-950 border rounded py-1.5 text-sm font-mono outline-none ${set.completed ? 'border-emerald-500/30 text-emerald-400' : 'border-slate-800 text-white'}`} /></div><div className="col-span-3"><SmartInput type="number" placeholder={prevStats?.sets[idx]?.reps || '-'} value={set.reps || ''} onCommit={(v) => updateSet(activeDayId, exercise.id, set.id, 'reps', v)} className={`w-full text-center bg-slate-950 border rounded py-1.5 text-sm font-mono outline-none ${set.completed ? 'border-emerald-500/30 text-emerald-400' : 'border-slate-800 text-white'}`} /></div><div className="col-span-3 flex justify-center"><button onClick={() => toggleSetComplete(activeDayId, exercise.id, set.id)} className={set.completed ? "text-emerald-500" : "text-slate-700 hover:text-slate-500"}>{set.completed ? <CheckCircle2 size={24} /> : <Circle size={24} />}</button></div><div className="col-span-2 flex justify-center"><button onClick={() => removeSet(activeDayId, exercise.id, set.id)} className="text-slate-700 hover:text-red-500 transition-colors"><X size={16} /></button></div></div>))}<button onClick={() => addSet(activeDayId, exercise.id)} className="w-full py-2 text-xs text-slate-500 border border-dashed border-slate-800 rounded hover:bg-slate-800 hover:text-blue-400 transition-colors">+ Add Set</button></div>)}</div></div>); })}<button onClick={() => openAddModal(activeDayId)} className="w-full py-4 rounded-xl border-2 border-dashed border-slate-800 text-slate-500 hover:border-blue-500 hover:text-blue-500 transition-colors flex items-center justify-center gap-2"><Plus size={20} /> Add Exercise</button></div><div className="mt-8 flex justify-center"><button onClick={() => openResetModal(activeDayId)} className="flex items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-bold py-4 px-12 rounded-2xl shadow-lg shadow-blue-500/20 transform hover:scale-105 transition-all"><Save size={20} /> Finish Workout</button></div></div>}
      </main>
    </div>
  );
}